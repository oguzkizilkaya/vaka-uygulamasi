<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hasta Vaka Hikayesi - Atipik Hemolitik Ãœremik Sendrom</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 800px;
            width: 100%;
            padding: 40px;
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .screen {
            display: none;
        }

        .screen.active {
            display: block;
            animation: slideIn 0.4s ease-out;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        h1 {
            color: #333;
            margin-bottom: 20px;
            font-size: 24px;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }

        .case-info {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 25px;
            border-left: 4px solid #667eea;
        }

        .case-info h3 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 18px;
        }

        .case-info p {
            color: #555;
            line-height: 1.6;
            margin-bottom: 8px;
        }

        .question {
            font-size: 18px;
            color: #333;
            margin-bottom: 25px;
            font-weight: 500;
            line-height: 1.5;
        }

        .options {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .option-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 18px 25px;
            border-radius: 10px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .option-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .error-screen {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 20px;
        }

        .error-screen h2 {
            color: #856404;
            margin-bottom: 15px;
            font-size: 20px;
        }

        .error-screen p {
            color: #856404;
            line-height: 1.6;
            margin-bottom: 10px;
        }

        .success-screen {
            background: #d4edda;
            border: 2px solid #28a745;
            border-radius: 10px;
            padding: 25px;
            text-align: center;
        }

        .success-screen h2 {
            color: #155724;
            margin-bottom: 15px;
            font-size: 24px;
        }

        .success-screen p {
            color: #155724;
            line-height: 1.6;
            font-size: 18px;
        }

        .back-btn {
            background: #6c757d;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 15px;
        }

        .back-btn:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }

        .progress {
            background: #e9ecef;
            height: 8px;
            border-radius: 10px;
            margin-bottom: 30px;
            overflow: hidden;
        }

        .progress-bar {
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            height: 100%;
            transition: width 0.5s ease;
            border-radius: 10px;
        }

        .admin-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #343a40;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 50px;
            cursor: pointer;
            font-size: 14px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .admin-btn:hover {
            background: #23272b;
            transform: translateY(-2px);
        }

        .admin-panel {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            overflow-y: auto;
            padding: 20px;
        }

        .admin-panel.active {
            display: flex;
            justify-content: center;
            align-items: flex-start;
        }

        .admin-content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            max-width: 1200px;
            width: 100%;
            margin-top: 50px;
            margin-bottom: 50px;
        }

        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            border-bottom: 2px solid #667eea;
            padding-bottom: 15px;
        }

        .close-admin {
            background: #dc3545;
            color: white;
            border: none;
            padding: 8px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-card h3 {
            font-size: 14px;
            margin-bottom: 10px;
            opacity: 0.9;
        }

        .stat-card .number {
            font-size: 32px;
            font-weight: bold;
        }

        .export-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            margin-right: 10px;
        }

        .clear-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }

        .attempt-badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 11px;
            margin: 2px;
            font-weight: bold;
        }

        .attempt-correct {
            background: #d4edda;
            color: #155724;
        }

        .attempt-incorrect {
            background: #f8d7da;
            color: #721c24;
        }

        .user-detail-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            border-left: 4px solid #667eea;
        }

        .user-detail-card h4 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .attempt-timeline {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-top: 8px;
        }

        .correct { color: #28a745; font-weight: bold; }
        .incorrect { color: #dc3545; font-weight: bold; }

        @media (max-width: 600px) {
            .container { padding: 25px; }
            h1 { font-size: 20px; }
            .question { font-size: 16px; }
            .option-btn { padding: 15px 20px; font-size: 15px; }
            .admin-content { padding: 20px; }
            .stats-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="progress">
            <div class="progress-bar" id="progressBar" style="width: 33%"></div>
        </div>

        <!-- Soru 1 -->
        <div class="screen active" id="soru1">
            <h1>Vaka DeÄŸerlendirmesi - AdÄ±m 1</h1>
            
            <div class="case-info">
                <h3>Hasta Bilgileri</h3>
                <p><strong>Ã–ykÃ¼:</strong> 28 yaÅŸÄ±nda kadÄ±n hasta, 1 haftadÄ±r devam eden halsizlik, solukluk ve idrar miktarÄ±nda azalma ÅŸikayeti ile baÅŸvurdu. Son gÃ¼nlerde koyu renkli idrar Ã§Ä±kardÄ±ÄŸÄ±nÄ± belirtiyor.</p>
                <p><strong>Muayene:</strong> TA: 165/95 mmHg, NabÄ±z: 102/dk, AteÅŸ: 36.8Â°C, Belirgin solukluk mevcut, pretibial Ã¶dem (+), bilinÃ§ aÃ§Ä±k ancak letarjik gÃ¶rÃ¼nÃ¼mde.</p>
                <p><strong>Laboratuar:</strong> Hemoglobin: 7.2 g/dL, Trombosit: 42.000/mmÂ³, Kreatinin: 4.8 mg/dL, LDH: 1850 U/L, Haptoglobin: dÃ¼ÅŸÃ¼k, Periferik yayma: ÅŸistosit (+), Direkt Coombs: negatif</p>
            </div>

            <p class="question">Mikroanjiyopatik hemolitik anemi, trombositopeni ve akut bÃ¶brek hasarÄ± triadÄ± ile baÅŸvuran bu hastada ayÄ±rÄ±cÄ± tanÄ± iÃ§in hangi tetkiki istersiniz?</p>
            
            <div class="options">
                <button class="option-btn" onclick="handleChoice('soru1', 'A', true, 'soru2')">
                    <strong>A)</strong> ADAMTS13 aktivitesi ve kompleman dÃ¼zeyleri (C3, C4, CH50)
                </button>
                <button class="option-btn" onclick="handleChoice('soru1', 'B', false, 'hata1')">
                    <strong>B)</strong> Sadece bÃ¶brek biyopsisi
                </button>
            </div>
        </div>

        <!-- Hata 1 -->
        <div class="screen" id="hata1">
            <div class="error-screen">
                <h2>âŒ SeÃ§iminiz YanlÄ±ÅŸ</h2>
                <p><strong>LiteratÃ¼r Bilgisi:</strong></p>
                <p>Trombotik mikroanjiyopati (TMA) tablosu ile baÅŸvuran hastalarda Ã¶ncelikle trombotik trombositopenik purpura (TTP) ve hemolitik Ã¼remik sendrom (HUS) ayrÄ±mÄ± yapÄ±lmalÄ±dÄ±r.</p>
                <p><strong>ADAMTS13 aktivitesi:</strong> TTP tanÄ±sÄ± iÃ§in kritiktir. Aktivite <%10 ise TTP, normal ise HUS dÃ¼ÅŸÃ¼nÃ¼lÃ¼r.</p>
                <p><strong>Kompleman dÃ¼zeyleri:</strong> Tipik HUS'ta normal, atipik HUS'ta (aHUS) dÃ¼ÅŸÃ¼k bulunur. C3, C4 ve CH50 dÃ¼zeyleri alternatif kompleman yolak disregÃ¼lasyonunu gÃ¶sterir.</p>
                <p>BÃ¶brek biyopsisi invaziv bir iÅŸlemdir ve TMA tanÄ±sÄ±nda ilk basamak tetkik deÄŸildir.</p>
            </div>
            <button class="back-btn" onclick="goToScreen('soru1')">â¬… Geri DÃ¶n</button>
        </div>

        <!-- Soru 2 -->
        <div class="screen" id="soru2">
            <h1>Vaka DeÄŸerlendirmesi - AdÄ±m 2</h1>
            
            <div class="case-info">
                <h3>Tetkik SonuÃ§larÄ±</h3>
                <p><strong>ADAMTS13 Aktivitesi:</strong> %45 (normal: >%50) - TTP ekarte</p>
                <p><strong>Kompleman DÃ¼zeyleri:</strong> C3: 62 mg/dL (dÃ¼ÅŸÃ¼k), C4: normal, CH50: dÃ¼ÅŸÃ¼k</p>
                <p><strong>Shiga toksin ve diare Ã¶ykÃ¼sÃ¼:</strong> Negatif (tipik HUS ekarte)</p>
                <p><strong>Genetik Panel:</strong> Kompleman faktÃ¶r H (CFH) mutasyonu saptandÄ±</p>
            </div>

            <p class="question">Bu tetkik sonuÃ§larÄ± ile hastada hangi tanÄ±yÄ± dÃ¼ÅŸÃ¼nÃ¼rsÃ¼nÃ¼z?</p>
            
            <div class="options">
                <button class="option-btn" onclick="handleChoice('soru2', 'A', true, 'soru3')">
                    <strong>A)</strong> Atipik hemolitik Ã¼remik sendrom (aHUS)
                </button>
                <button class="option-btn" onclick="handleChoice('soru2', 'B', false, 'hata2')">
                    <strong>B)</strong> Trombotik trombositopenik purpura (TTP)
                </button>
            </div>
        </div>

        <!-- Hata 2 -->
        <div class="screen" id="hata2">
            <div class="error-screen">
                <h2>âŒ SeÃ§iminiz YanlÄ±ÅŸ</h2>
                <p><strong>LiteratÃ¼r Bilgisi:</strong></p>
                <p>Trombotik trombositopenik purpura (TTP) tanÄ±sÄ± iÃ§in ADAMTS13 aktivitesinin <%10 olmasÄ± gerekir. Bu hastada ADAMTS13 aktivitesi %45 olarak saptanmÄ±ÅŸ olup TTP tanÄ±sÄ±nÄ± ekarte eder.</p>
                <p><strong>Bu hastada aHUS lehine bulgular:</strong></p>
                <p>â€¢ Normal ADAMTS13 aktivitesi</p>
                <p>â€¢ DÃ¼ÅŸÃ¼k C3 ve CH50 dÃ¼zeyleri</p>
                <p>â€¢ Belirgin bÃ¶brek tutulumu</p>
                <p>â€¢ Kompleman faktÃ¶r H (CFH) mutasyonu</p>
            </div>
            <button class="back-btn" onclick="goToScreen('soru2')">â¬… Geri DÃ¶n</button>
        </div>

        <!-- Soru 3 -->
        <div class="screen" id="soru3">
            <h1>Vaka DeÄŸerlendirmesi - AdÄ±m 3</h1>
            
            <div class="case-info">
                <h3>TanÄ±</h3>
                <p><strong>Kesin TanÄ±:</strong> Atipik Hemolitik Ãœremik Sendrom (aHUS)</p>
                <p><strong>Klinik Durum:</strong> Akut bÃ¶brek hasarÄ±, mikroanjiyopatik hemolitik anemi, trombositopeni</p>
            </div>

            <p class="question">Bu tanÄ±lÄ± hastada tedaviniz ne olurdu?</p>
            
            <div class="options">
                <button class="option-btn" onclick="handleChoice('soru3', 'A', true, 'sonuc')">
                    <strong>A)</strong> Eculizumab (kompleman C5 inhibitÃ¶rÃ¼) tedavisi ve destekleyici bakÄ±m
                </button>
                <button class="option-btn" onclick="handleChoice('soru3', 'B', false, 'hata3')">
                    <strong>B)</strong> Sadece plazma deÄŸiÅŸimi ve kortikosteroid tedavisi
                </button>
            </div>
        </div>

        <!-- Hata 3 -->
        <div class="screen" id="hata3">
            <div class="error-screen">
                <h2>âŒ SeÃ§iminiz YanlÄ±ÅŸ</h2>
                <p><strong>LiteratÃ¼r Bilgisi:</strong></p>
                <p>Atipik HUS tedavisinde altÄ±n standart <strong>eculizumab (SolirisÂ®)</strong> gibi kompleman C5 inhibitÃ¶rleridir.</p>
                <p><strong>Eculizumab tedavisinin Ã¶nemi:</strong></p>
                <p>â€¢ Terminal kompleman aktivasyonunu bloke eder</p>
                <p>â€¢ Hemolizi durdurur ve trombosit sayÄ±sÄ±nÄ± dÃ¼zeltir</p>
                <p>â€¢ BÃ¶brek fonksiyonlarÄ±nÄ± korur/iyileÅŸtirir</p>
                <p>â€¢ Mortaliteyi %90'dan %10'un altÄ±na dÃ¼ÅŸÃ¼rÃ¼r</p>
            </div>
            <button class="back-btn" onclick="goToScreen('soru3')">â¬… Geri DÃ¶n</button>
        </div>

        <!-- SonuÃ§ -->
        <div class="screen" id="sonuc">
            <div class="success-screen">
                <h2>ğŸ‰ Tebrikler!</h2>
                <p><strong>Tedavi YanÄ±tÄ±:</strong></p>
                <p>HastanÄ±za eculizumab tedavisi baÅŸlandÄ±.</p>
                <p style="margin-top: 15px;"><strong>Klinik Seyir:</strong></p>
                <p>â€¢ 1. hafta: Hemoliz belirteÃ§leri dÃ¼zelmeye baÅŸladÄ±</p>
                <p>â€¢ 2. hafta: Trombosit sayÄ±sÄ± normale dÃ¶ndÃ¼</p>
                <p>â€¢ 4. hafta: Hemoglobin 11.8 g/dL'ye yÃ¼kseldi</p>
                <p>â€¢ 8. hafta: BÃ¶brek fonksiyonlarÄ± tam dÃ¼zelme gÃ¶sterdi</p>
                <p style="margin-top: 20px; font-weight: bold;">VakayÄ± baÅŸarÄ±yla tamamladÄ±nÄ±z! âœ…</p>
            </div>
            <button class="back-btn" onclick="resetCase()" style="background: #28a745; margin-top: 25px;">
                ğŸ”„ VakayÄ± Yeniden BaÅŸlat
            </button>
        </div>
    </div>

    <!-- Admin Butonu -->
    <button class="admin-btn" onclick="openAdminPanel()">ğŸ“Š Veri Analizi</button>

    <!-- Admin Panel -->
    <div class="admin-panel" id="adminPanel">
        <div class="admin-content">
            <div class="admin-header">
                <h1>KullanÄ±cÄ± SeÃ§im Analizi</h1>
                <button class="close-admin" onclick="closeAdminPanel()">âœ• Kapat</button>
            </div>

            <div class="stats-grid" id="statsGrid"></div>

            <div style="margin-bottom: 20px;">
                <button class="export-btn" onclick="exportToCSV()">ğŸ“¥ CSV Ä°ndir</button>
                <button class="export-btn" onclick="exportToJSON()">ğŸ“¥ JSON Ä°ndir</button>
                <button class="clear-btn" onclick="clearAllData()">ğŸ—‘ï¸ TÃ¼m Verileri Temizle</button>
            </div>

            <h2 style="margin-bottom: 15px; color: #333;">DetaylÄ± KullanÄ±cÄ± Denemeleri</h2>
            <div id="userDetailsContainer"></div>

            <h2 style="margin-top: 30px; margin-bottom: 15px; color: #333;">Soru BazlÄ± Analiz</h2>
            <div id="questionAnalysis"></div>
        </div>
    </div>

    <script>
        let currentSession = {
            userId: generateUserId(),
            timestamp: new Date().toISOString(),
            questions: {
                soru1: { attempts: [] },
                soru2: { attempts: [] },
                soru3: { attempts: [] }
            }
        };

        function generateUserId() {
            return 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }

        function handleChoice(questionId, choice, isCorrect, nextScreen) {
            currentSession.questions[questionId].attempts.push({
                choice: choice,
                isCorrect: isCorrect,
                timestamp: new Date().toISOString()
            });
            goToScreen(nextScreen);
        }

        function goToScreen(screenId) {
            const screens = document.querySelectorAll('.screen');
            screens.forEach(screen => screen.classList.remove('active'));
            document.getElementById(screenId).classList.add('active');
            updateProgress(screenId);
            window.scrollTo({ top: 0, behavior: 'smooth' });
            if (screenId === 'sonuc') saveSession();
        }

        function updateProgress(screenId) {
            const progressBar = document.getElementById('progressBar');
            const widths = {
                'soru1': '33%', 'hata1': '33%',
                'soru2': '66%', 'hata2': '66%',
                'soru3': '100%', 'hata3': '100%', 'sonuc': '100%'
            };
            progressBar.style.width = widths[screenId] || '33%';
        }

        function saveSession() {
            try {
                let sessions = JSON.parse(localStorage.getItem('caseSessions') || '[]');
                sessions.push(currentSession);
                localStorage.setItem('caseSessions', JSON.stringify(sessions));
                console.log('Veri kaydedildi. Toplam:', sessions.length);
            } catch(e) {
                console.error('KayÄ±t hatasÄ±:', e);
            }
        }

        function resetCase() {
            currentSession = {
                userId: generateUserId(),
                timestamp: new Date().toISOString(),
                questions: {
                    soru1: { attempts: [] },
                    soru2: { attempts: [] },
                    soru3: { attempts: [] }
                }
            };
            goToScreen('soru1');
        }

        function openAdminPanel() {
            document.getElementById('adminPanel').classList.add('active');
            loadAdminData();
        }

        function closeAdminPanel() {
            document.getElementById('adminPanel').classList.remove('active');
        }

        function loadAdminData() {
            const sessions = JSON.parse(localStorage.getItem('caseSessions') || '[]');
            displayStats(sessions);
            displayUserDetails(sessions);
            displayQuestionAnalysis(sessions);
        }

        function displayStats(sessions) {
            const statsGrid = document.getElementById('statsGrid');
            if (sessions.length === 0) {
                statsGrid.innerHTML = '<div class="stat-card"><h3>HenÃ¼z Veri Yok</h3><div class="number">0</div></div>';
                return;
            }

            const totalUsers = sessions.length;
            const q1FirstCorrect = sessions.filter(s => s.questions.soru1.attempts[0]?.isCorrect).length;
            const q2FirstCorrect = sessions.filter(s => s.questions.soru2.attempts[0]?.isCorrect).length;
            const q3FirstCorrect = sessions.filter(s => s.questions.soru3.attempts[0]?.isCorrect).length;

            const avgQ1 = (sessions.reduce((sum, s) => sum + s.questions.soru1.attempts.length, 0) / totalUsers).toFixed(1);
            const avgQ2 = (sessions.reduce((sum, s) => sum + s.questions.soru2.attempts.length, 0) / totalUsers).toFixed(1);
            const avgQ3 = (sessions.reduce((sum, s) => sum + s.questions.soru3.attempts.length, 0) / totalUsers).toFixed(1);

            statsGrid.innerHTML = `
                <div class="stat-card">
                    <h3>Toplam KullanÄ±cÄ±</h3>
                    <div class="number">${totalUsers}</div>
                </div>
                <div class="stat-card">
                    <h3>Soru 1 Ä°lk Deneme BaÅŸarÄ±</h3>
                    <div class="number">${((q1FirstCorrect/totalUsers)*100).toFixed(1)}%</div>
                    <div style="font-size: 12px; margin-top: 5px;">Ort. ${avgQ1} deneme</div>
                </div>
                <div class="stat-card">
                    <h3>Soru 2 Ä°lk Deneme BaÅŸarÄ±</h3>
                    <div class="number">${((q2FirstCorrect/totalUsers)*100).toFixed(1)}%</div>
                    <div style="font-size: 12px; margin-top: 5px;">Ort. ${avgQ2} deneme</div>
                </div>
                <div class="stat-card">
                    <h3>Soru 3 Ä°lk Deneme BaÅŸarÄ±</h3>
                    <div class="number">${((q3FirstCorrect/totalUsers)*100).toFixed(1)}%</div>
                    <div style="font-size: 12px; margin-top: 5px;">Ort. ${avgQ3} deneme</div>
                </div>
            `;
        }

        function displayUserDetails(sessions) {
            const container = document.getElementById('userDetailsContainer');
            if (sessions.length === 0) {
                container.innerHTML = '<p style="color: #999; text-align: center; padding: 20px;">HenÃ¼z kayÄ±tlÄ± kullanÄ±cÄ± verisi bulunmamaktadÄ±r.</p>';
                return;
            }

            container.innerHTML = '';
            sessions.slice().reverse().forEach((session, index) => {
                const date = new Date(session.timestamp).toLocaleString('tr-TR');
                const card = document.createElement('div');
                card.className = 'user-detail-card';

                let html = `<h4>KullanÄ±cÄ± #${sessions.length - index} - ${date}</h4>`;
                html += `<p style="font-size: 12px; color: #666; margin-bottom: 15px;">ID: ${session.userId}</p>`;

                ['soru1', 'soru2', 'soru3'].forEach((qId, qIndex) => {
                    const questionTitles = ['Soru 1: Tetkik SeÃ§imi', 'Soru 2: TanÄ± Koyma', 'Soru 3: Tedavi SeÃ§imi'];
                    const attempts = session.questions[qId].attempts;

                    html += `<div style="margin-bottom: 12px;"><strong>${questionTitles[qIndex]}:</strong> `;

                    if (attempts.length === 0) {
                        html += `<span style="color: #999;">CevaplanmadÄ±</span>`;
                    } else {
                        html += `<div class="attempt-timeline">`;
                        attempts.forEach((attempt, attemptIndex) => {
                            const badgeClass = attempt.isCorrect ? 'attempt-correct' : 'attempt-incorrect';
                            const icon = attempt.isCorrect ? 'âœ“' : 'âœ—';
                            html += `<span class="attempt-badge ${badgeClass}">${attemptIndex + 1}. ${attempt.choice} ${icon}</span>`;
                        });
                        html += `</div>`;

                        const firstCorrect = attempts[0].isCorrect;
                        html += `<div style="font-size: 12px; color: #666; margin-top: 5px;">`;
                        html += `${attempts.length} deneme - `;
                        html += firstCorrect ? 
                            '<span style="color: #28a745;">Ä°lk denemede doÄŸru âœ“</span>' : 
                            `<span style="color: #dc3545;">${attempts.length}. denemede doÄŸru</span>`;
                        html += `</div>`;
                    }
                    html += `</div>`;
                });

                const totalAttempts = 
                    session.questions.soru1.attempts.length +
                    session.questions.soru2.attempts.length +
                    session.questions.soru3.attempts.length;

                const firstTimeCorrect = 
                    (session.questions.soru1.attempts[0]?.isCorrect ? 1 : 0) +
                    (session.questions.soru2.attempts[0]?.isCorrect ? 1 : 0) +
                    (session.questions.soru3.attempts[0]?.isCorrect ? 1 : 0);

                html += `<div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #ddd;">`;
                html += `<strong>Genel Performans:</strong> ${firstTimeCorrect}/3 soru ilk denemede doÄŸru, Toplam ${totalAttempts} deneme</div>`;

                card.innerHTML = html;
                container.appendChild(card);
            });
        }

        function displayQuestionAnalysis(sessions) {
            const analysisDiv = document.getElementById('questionAnalysis');
            if (sessions.length === 0) {
                analysisDiv.innerHTML = '<p style="color: #999; text-align: center; padding: 20px;">HenÃ¼z analiz edilecek veri bulunmamaktadÄ±r.</p>';
                return;
            }

            const questions = ['soru1', 'soru2', 'soru3'];
            const questionTitles = ['Soru 1: Tetkik SeÃ§imi', 'Soru 2: TanÄ± Koyma', 'Soru 3: Tedavi SeÃ§imi'];
            let html = '';

            questions.forEach((q, index) => {
                let totalAttempts = 0;
                let choiceACount = 0;
                let choiceBCount = 0;
                let firstTimeCorrect = 0;
                let secondTimeCorrect = 0;
                let thirdOrMoreCorrect = 0;

                sessions.forEach(session => {
                    const attempts = session.questions[q].attempts;
                    totalAttempts += attempts.length;

                    attempts.forEach(attempt => {
                        if (attempt.choice === 'A') choiceACount++;
                        if (attempt.choice === 'B') choiceBCount++;
                    });

                    const correctAttemptIndex = attempts.findIndex(a => a.isCorrect);
                    if (correctAttemptIndex === 0) firstTimeCorrect++;
                    else if (correctAttemptIndex === 1) secondTimeCorrect++;
                    else if (correctAttemptIndex > 1) thirdOrMoreCorrect++;
                });

                const totalUsers = sessions.length;
                const avgAttempts = (totalAttempts / totalUsers).toFixed(2);
                const firstTimeRate = ((firstTimeCorrect / totalUsers) * 100).toFixed(1);

                html += `
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 15px;">
                        <h3 style="color: #667eea; margin-bottom: 10px;">${questionTitles[index]}</h3>
                        <p><strong>Toplam KullanÄ±cÄ±:</strong> ${totalUsers}</p>
                        <p><strong>Toplam Deneme:</strong> ${totalAttempts}</p>
                        <p><strong>Ortalama Deneme:</strong> ${avgAttempts}</p>
                        <p><strong>A ÅÄ±kkÄ± SeÃ§ilme:</strong> ${choiceACount} kez</p>
                        <p><strong>B ÅÄ±kkÄ± SeÃ§ilme:</strong> ${choiceBCount} kez</p>
                        <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #ddd;">
                            <p><strong>Ä°lk Denemede BaÅŸarÄ±:</strong> <span class="correct">${firstTimeCorrect} kullanÄ±cÄ± (${firstTimeRate}%)</span></p>
                            <p><strong>2. Denemede BaÅŸarÄ±:</strong> <span style="color: #ffc107;">${secondTimeCorrect} kullanÄ±cÄ±</span></p>
                            <p><strong>3+ Denemede BaÅŸarÄ±:</strong> <span class="incorrect">${thirdOrMoreCorrect} kullanÄ±cÄ±</span></p>
                        </div>
                    </div>
                `;
            });

            analysisDiv.innerHTML = html;
        }

        function exportToCSV() {
            const sessions = JSON.parse(localStorage.getItem('caseSessions') || '[]');
            if (sessions.length === 0) {
                alert('HenÃ¼z dÄ±ÅŸa aktarÄ±lacak veri bulunmamaktadÄ±r.');
                return;
            }

            let csv = 'KullanÄ±cÄ± ID,Tarih,S1 Deneme,S1 Ä°lk,S1 DoÄŸru,S1 TÃ¼m,S2 Deneme,S2 Ä°lk,S2 DoÄŸru,S2 TÃ¼m,S3 Deneme,S3 Ä°lk,S3 DoÄŸru,S3 TÃ¼m\n';

            sessions.forEach(session => {
                const date = new Date(session.timestamp).toLocaleString('tr-TR');
                csv += `${session.userId},${date},`;

                ['soru1', 'soru2', 'soru3'].forEach(q => {
                    const attempts = session.questions[q].attempts;
                    const attemptCount = attempts.length;
                    const firstChoice = attempts[0]?.choice || '';
                    const firstCorrect = attempts[0]?.isCorrect || false;
                    const allAttempts = attempts.map(a => `${a.choice}${a.isCorrect ? 'âœ“' : 'âœ—'}`).join('â†’');

                    csv += `${attemptCount},${firstChoice},${firstCorrect},"${allAttempts}",`;
                });

                csv += '\n';
            });

            downloadFile(csv, 'vaka-verileri-detayli.csv', 'text/csv;charset=utf-8;');
        }

        function exportToJSON() {
            const sessions = JSON.parse(localStorage.getItem('caseSessions') || '[]');
            if (sessions.length === 0) {
                alert('HenÃ¼z dÄ±ÅŸa aktarÄ±lacak veri bulunmamaktadÄ±r.');
                return;
            }

            const json = JSON.stringify(sessions, null, 2);
            downloadFile(json, 'vaka-verileri-detayli.json', 'application/json');
        }

        function downloadFile(content, filename, contentType) {
            const BOM = '\uFEFF';
            const blob = new Blob([BOM + content], { type: contentType });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = filename;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
        }

        function clearAllData() {
            if (confirm('TÃ¼m kullanÄ±cÄ± verilerini silmek istediÄŸinizden emin misiniz? Bu iÅŸlem geri alÄ±namaz.')) {
                localStorage.removeItem('caseSessions');
                loadAdminData();
                alert('TÃ¼m veriler baÅŸarÄ±yla silindi.');
            }
        }
    </script>
</body>
</html>